from django.http import HttpResponse
from django.db.models import Count
from django.db.models import Q
from .models import Category, Article


def loadexampledata(request):
    html=""
    Category.objects.all().delete()
    Article.objects.all().delete()
    c = Category(title="Classics")
    c.save()
    a = Article(title="Lore Olympus", text="Volume 1", category=c, published=True, read_min=120)
    a.save()
    a = Article(title="Saga", text="Volume 2", category=c, published=False, read_min=90)
    a.save()
    a = Article(title="Avatar", text="Volume 3", category=c, published=False, read_min=60)
    a.save()
    c = Category(title="Fantasy")
    c.save()
    a = Article(title="Memories", text="Music", category=c, published=True, read_min=80)
    a.save()
    c = Category(title="Horor")
    c.save()
    a = Article(title="Conan", text="Anime", category=c, published=True, read_min=100)
    a.save()
    a = Article(title="Doraemon", text="Anime", category=c, published=False, read_min=64)
    a.save()
    return HttpResponse(html)

def category(request):
    field = request.GET.get('field', 'name')
    categories_amount = Category.objects.annotate(**{field:Count("article")})
    rows = ""
    for category_amount in categories_amount:
        rows += "<tr><td><h2>%s</h2></td><td><h2>%s</h2></td></tr>" % (category_amount.title, getattr(category_amount, field))
    table = "<table align=\"center\" cellspacing=\"10\" bgcolor=\"#000000\"><thead><tr><th><h2>Category</h2></th><th><h2>%s</h2></th></tr></thead>" \
            "<tbody align=\"center\" bgcolor=\"#ffffff\">%s</tbody></table>" %(field, rows)
    html = "<html><body><h1 align=\"center\">Table category and amount article of category</h1><br /><br />%s</body></html>" % table
    return HttpResponse(html)
